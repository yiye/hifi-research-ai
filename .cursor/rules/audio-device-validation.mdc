---
description: 音频设备数据验证和格式规范
globs:
  - "**/*device*.{ts,js,json}"
  - "**/*spec*.{ts,js,json}"
  - "**/data/**/*.{ts,js,json}"
alwaysApply: false
---

# 音频设备数据验证规则

## 数据验证要求

### 必填字段检查
所有设备数据必须包含：
- `deviceType`: 必须是预定义的设备类型之一
- `manufacturer`: 制造商名称（非空字符串）
- `model`: 型号（非空字符串）
- `specs`: 技术规格对象

### 数值范围验证

#### 采样率（Sample Rate）
- 必须是标准值：44100, 48000, 88200, 96000, 176400, 192000, 352800, 384000, 705600, 768000
- 单位：Hz
- 最大值不应超过 1536000 (DSD512)

#### 位深度（Bit Depth）
- 允许值：16, 24, 32
- 不要使用浮点数

#### THD (总谐波失真)
- 范围：0.0001% - 10%
- 超过 1% 通常认为不合格
- 必须标注测试条件（频率、电平、负载）

#### SNR (信噪比)
- 范围：60dB - 140dB
- 低于 80dB 通常认为较差
- 高于 130dB 需要验证测试方法

#### 阻抗
- 耳机：8Ω - 600Ω（常见：16, 32, 50, 80, 150, 250, 300, 600）
- 音箱：4Ω - 16Ω（常见：4, 6, 8）

#### 频率响应
- 下限：5Hz - 50Hz
- 上限：15kHz - 100kHz
- 人耳范围：20Hz - 20kHz

### 单位标准化

```typescript
// 好的示例
const device = {
  specs: {
    sampleRate: { max: 768000, unit: 'Hz' },
    thd: { value: 0.0005, unit: '%', condition: '1kHz, -1dBFS, 32Ω' },
    snr: { value: 120, unit: 'dB', weight: 'A' },
    power: { value: 500, unit: 'mW', load: 32, unit_load: 'Ω' }
  }
};

// 避免的做法
const badDevice = {
  specs: {
    sampleRate: "768k",  // ❌ 应使用数值
    thd: 0.05,           // ❌ 缺少单位和测试条件
    snr: "120dB",        // ❌ 应分离数值和单位
    power: "0.5W"        // ❌ 应使用 mW 且分离单位
  }
};
```

### 数据完整性

每个测量值应包含：
1. 数值（number）
2. 单位（string）
3. 测试条件（object）
4. 数据来源（可选）
5. 测试日期（可选）

```typescript
interface Measurement {
  value: number;
  unit: string;
  condition: {
    frequency?: number;      // Hz
    amplitude?: number;      // dBFS or V
    load?: number;          // Ω
    gain?: number;          // dB
    temperature?: number;   // °C
  };
  source?: string;
  testDate?: string;
  equipment?: string;
}
```

### 枚举类型定义

```typescript
type DeviceType = 
  | 'DAC' 
  | 'Amplifier' 
  | 'Headphone' 
  | 'IEM' 
  | 'Speaker' 
  | 'StreamingDAC' 
  | 'IntegratedAmp'
  | 'Preamplifier'
  | 'PowerAmplifier';

type ConnectivityType = 
  | 'USB'
  | 'Bluetooth'
  | 'Optical'
  | 'Coaxial'
  | 'XLR'
  | 'RCA'
  | 'Balanced_XLR'
  | 'Balanced_4.4mm'
  | 'Balanced_2.5mm'
  | '3.5mm'
  | '6.35mm'
  | 'I2S'
  | 'AES/EBU'
  | 'WiFi'
  | 'Ethernet';

type BluetoothCodec = 
  | 'SBC' 
  | 'AAC' 
  | 'aptX' 
  | 'aptX_HD' 
  | 'aptX_Adaptive'
  | 'LDAC' 
  | 'LHDC'
  | 'LC3';
```

## 价格数据规范

```typescript
interface Price {
  value: number;
  currency: 'CNY' | 'USD' | 'EUR' | 'JPY';
  date: string;  // ISO 8601 format
  source?: string;
  isOfficial: boolean;
}
```

## 错误处理

- 数据验证失败时，提供清晰的错误信息
- 指出具体哪个字段不符合要求
- 提供正确的示例
- 记录验证警告（如数值异常但在允许范围内）
